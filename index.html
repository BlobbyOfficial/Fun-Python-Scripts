<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Fun Python Scripts</title>
  <meta name="description" content="Fun Python Scripts is a beautiful, modern webapp to browse, view, and download Python scripts. Built by blobbyofficial." />
  <meta name="keywords" content="fun python scripts, python, scripts, download, open source, code, cli, utilities, games, learning, blobbyofficial, programming, showcase, portfolio, tools, education, beginner, advanced, projects, code snippets, interactive, webapp, nodejs, express, beautiful, modern, responsive, animated, polished, creative, coding, software, free, open, MIT, utilities, productivity, entertainment, showcase, blobbyofficial.com" />
  <meta name="author" content="blobbyofficial" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://fun-python-scripts.vercel.app" />
  <meta property="og:title" content="Fun Python Scripts — Download, View, and Learn" />
  <meta property="og:description" content="A beautiful, modern webapp to browse, view, and download Python scripts. Built by blobbyofficial." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://fun-python-scripts.vercel.app" />
  <meta property="og:image" content="/favicon.ico" />
  <meta property="og:site_name" content="Fun Python Scripts" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Fun Python Scripts — Download, View, and Learn" />
  <meta name="twitter:description" content="A beautiful, modern webapp to browse, view, and download Python scripts. Built by blobbyofficial." />
  <meta name="twitter:image" content="/favicon.ico" />
  <meta name="twitter:creator" content="@blobby_official" />
  <meta name="theme-color" content="#181c24" />
  <link rel="apple-touch-icon" href="/favicon.ico" />
  <link rel="icon" type="image/x-icon" href="/favicon.ico" />
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/public/styles.css">
  <style>
    details summary::-webkit-details-marker { display: none; }
    /* Minimal inline tweaks, rest in styles.css */
  </style>
</head>
<body>
  <div id="loading-screen">
    <div class="spinner"></div>
    <div class="loading-bar-container">
      <div class="loading-bar"></div>
    </div>
  </div>
  <nav class="navbar">
    <a href="https://blobbyofficial.com" class="navbar-icon" title="Visit blobbyofficial.com" target="_blank" rel="noopener">
      <img src="/favicon.ico" alt="blobbyofficial icon" width="32" height="32" style="border-radius:8px;vertical-align:middle;box-shadow:0 2px 8px rgba(0,0,0,0.12);">
    </a>
    <span class="navbar-title">Fun Python Scripts</span>
    <button id="theme-toggle" class="theme-toggle" aria-label="Toggle dark/light mode">
      <span id="theme-toggle-icon" aria-hidden="true">🌙</span>
    </button>
  </nav>
  <header>
    <h1>Fun Python Scripts</h1>
    <p style="text-align:center; color:#555; margin-top:-18px; margin-bottom:32px;">
      Download and view the source code for simple, fun Python projects.
    </p>
  </header>
  <main>
    <noscript>
      <div style="color: #b00; text-align: center; margin: 2em;">
        This website requires JavaScript to display the scripts.
      </div>
    </noscript>
    <div id="scripts"></div>
  </main>
  <footer style="text-align:center; color:#aaa; font-size:0.95em; margin:40px 0 16px 0;">
    &copy; 2024 Fun Python Scripts
  </footer>
  <script>
    // Theme toggle logic
    function setTheme(mode) {
      document.documentElement.setAttribute('data-theme', mode);
      localStorage.setItem('theme', mode);
      document.getElementById('theme-toggle-icon').textContent = mode === 'dark' ? '🌙' : '☀️';
    }
    function toggleTheme() {
      const current = localStorage.getItem('theme') || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      setTheme(current === 'dark' ? 'light' : 'dark');
    }
    document.addEventListener('DOMContentLoaded', () => {
      // Set theme on load
      const saved = localStorage.getItem('theme');
      if (saved) setTheme(saved);
      else setTheme(window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
      document.getElementById('theme-toggle').onclick = toggleTheme;
    });

    // Fetch scripts from the Node.js backend and render them
    function escapeHTML(str) {
      return str.replace(/[&<>"']/g, function(m) {
        return ({
          '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;'
        })[m];
      });
    }

    function toggleSource(id) {
      const srcDiv = document.getElementById('src-' + id);
      const btn = document.getElementById('btn-' + id);
      if (!srcDiv || !btn) return;
      if (srcDiv.style.display === 'none') {
        srcDiv.style.display = 'block';
        btn.textContent = 'Hide Source';
      } else {
        srcDiv.style.display = 'none';
        btn.textContent = 'View Source';
      }
    }

    async function fetchAndRenderScripts() {
      const container = document.getElementById('scripts');
      container.innerHTML = '<p>Loading scripts...</p>';
      try {
        const res = await fetch('/api/scripts');
        const scripts = await res.json();
        if (!Array.isArray(scripts) || scripts.length === 0) {
          container.innerHTML = '<p>No scripts found.</p>';
          return;
        }
        container.innerHTML = scripts.map((script, idx) => `
          <div class="script">
            <details>
              <summary>${escapeHTML(script.name)}</summary>
              <div class="details-content">
                <p>${escapeHTML(script.description)}</p>
                <a class="download-btn" href="/scripts/${encodeURIComponent(script.folder)}/${encodeURIComponent(script.filename)}" download>Download ${escapeHTML(script.filename)}</a>
                <button id="btn-${idx}" onclick="toggleSource('${idx}')">View Source</button>
                <div id="src-${idx}" style="display:none;"><pre>Loading...</pre></div>
              </div>
            </details>
          </div>
        `).join('');

        // Attach event listeners for source code loading
        scripts.forEach((script, idx) => {
          const btn = document.getElementById('btn-' + idx);
          if (btn) {
            btn.addEventListener('click', async function handler() {
              const srcDiv = document.getElementById('src-' + idx);
              if (srcDiv && srcDiv.textContent === 'Loading...') {
                // Fetch source code from backend
                const resp = await fetch(`/scripts/${encodeURIComponent(script.folder)}/${encodeURIComponent(script.filename)}`);
                if (resp.ok) {
                  const code = await resp.text();
                  srcDiv.innerHTML = `<pre>${escapeHTML(code)}</pre>`;
                } else {
                  srcDiv.innerHTML = `<pre>Unable to load source code.</pre>`;
                }
              }
              // Remove this handler after first load
              btn.removeEventListener('click', handler);
            });
          }
        });
      } catch (e) {
        container.innerHTML = '<p>Error loading scripts.</p>';
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      fetchAndRenderScripts();
      // Hide loading screen after content is loaded
      const loadingScreen = document.getElementById('loading-screen');
      if (loadingScreen) {
        setTimeout(() => {
          loadingScreen.classList.add('hide');
        }, 600); // smooth fade out
      }
    });
  </script>
</body>
</html>
    }
  </script>
</body>
</html>
